resource "aws_ecs_task_definition" "tfer--task-definition-002F-cream-task" {
  container_definitions    = "[{\"dependsOn\":[{\"condition\":\"HEALTHY\",\"containerName\":\"postgres\"}],\"environment\":[{\"name\":\"AWS_REGION\",\"value\":\"us-east-1\"},{\"name\":\"CLOUDWATCH_ENABLED\",\"value\":\"true\"},{\"name\":\"CLOUDWATCH_FAULT_CODES\",\"value\":\"FAULT_SQL_INJECTION_TEST,FAULT_EXTERNAL_API_LATENCY,FAULT_DB_TIMEOUT\"},{\"name\":\"CLOUDWATCH_FILTER_PATTERN\",\"value\":\"\"},{\"name\":\"CLOUDWATCH_LIMIT_PER_GROUP\",\"value\":\"200\"},{\"name\":\"CLOUDWATCH_LOG_GROUPS\",\"value\":\"/aws/lambda/FaultRouter\"},{\"name\":\"CLOUDWATCH_LOOKBACK_MINUTES\",\"value\":\"240\"},{\"name\":\"CLOUDWATCH_ONLY_FAULT_CODES\",\"value\":\"true\"},{\"name\":\"MOCK_API_BASE_URL\",\"value\":\"http://localhost:5001\"},{\"name\":\"NODE_ENV\",\"value\":\"production\"},{\"name\":\"POSTGRES_DB\",\"value\":\"hello\"},{\"name\":\"POSTGRES_HOST\",\"value\":\"localhost\"},{\"name\":\"POSTGRES_PASSWORD\",\"value\":\"password\"},{\"name\":\"POSTGRES_PORT\",\"value\":\"5432\"},{\"name\":\"POSTGRES_USER\",\"value\":\"hello\"},{\"name\":\"SECRET_KEY\",\"value\":\"123456789\"}],\"essential\":true,\"healthCheck\":{\"command\":[\"CMD-SHELL\",\"curl -f http://localhost:8000/health || exit 1\"],\"interval\":30,\"retries\":3,\"startPeriod\":10,\"timeout\":5},\"image\":\"244996607989.dkr.ecr.us-east-1.amazonaws.com/creamandonion:8af851ab5d6e2d26e556fb617d3aa6f9f6973e83\",\"logConfiguration\":{\"logDriver\":\"awslogs\",\"options\":{\"awslogs-stream-prefix\":\"ecs\",\"awslogs-group\":\"/ecs/cream-task\",\"awslogs-create-group\":\"true\",\"awslogs-region\":\"us-east-1\"}},\"mountPoints\":[],\"name\":\"cream-container\",\"portMappings\":[{\"appProtocol\":\"http\",\"containerPort\":8000,\"hostPort\":8000,\"name\":\"cream-container-8000-tcp\",\"protocol\":\"tcp\"}],\"systemControls\":[],\"volumesFrom\":[]},{\"environment\":[{\"name\":\"API_FAULT_MODE\",\"value\":\"latency,error\"}],\"essential\":false,\"healthCheck\":{\"command\":[\"CMD-SHELL\",\"python -c \\\"import urllib.request; urllib.request.urlopen('http://localhost:5001/health', timeout=3).read()\\\" || exit 1\"],\"interval\":30,\"retries\":3,\"startPeriod\":10,\"timeout\":5},\"image\":\"244996607989.dkr.ecr.us-east-1.amazonaws.com/mock-api:latest\",\"logConfiguration\":{\"logDriver\":\"awslogs\",\"options\":{\"awslogs-create-group\":\"true\",\"awslogs-region\":\"us-east-1\",\"awslogs-stream-prefix\":\"mock-api\",\"awslogs-group\":\"/ecs/cream-task\"}},\"mountPoints\":[],\"name\":\"mock-api\",\"portMappings\":[{\"containerPort\":5001,\"hostPort\":5001,\"protocol\":\"tcp\"}],\"systemControls\":[],\"volumesFrom\":[]},{\"environment\":[{\"name\":\"POSTGRES_DB\",\"value\":\"hello\"},{\"name\":\"POSTGRES_PASSWORD\",\"value\":\"password\"},{\"name\":\"POSTGRES_USER\",\"value\":\"hello\"}],\"essential\":true,\"healthCheck\":{\"command\":[\"CMD-SHELL\",\"pg_isready -U hello\"],\"interval\":10,\"retries\":5,\"startPeriod\":60,\"timeout\":5},\"image\":\"244996607989.dkr.ecr.us-east-1.amazonaws.com/hack-postgres:latest\",\"logConfiguration\":{\"logDriver\":\"awslogs\",\"options\":{\"awslogs-group\":\"/ecs/cream-task\",\"awslogs-create-group\":\"true\",\"awslogs-region\":\"us-east-1\",\"awslogs-stream-prefix\":\"postgres\"}},\"mountPoints\":[],\"name\":\"postgres\",\"portMappings\":[{\"containerPort\":5432,\"hostPort\":5432,\"protocol\":\"tcp\"}],\"systemControls\":[],\"volumesFrom\":[]}]"
  cpu                      = "512"
  enable_fault_injection   = "false"
  execution_role_arn       = "arn:aws:iam::244996607989:role/ecsTaskExecutionRole"
  family                   = "cream-task"
  memory                   = "3072"
  network_mode             = "awsvpc"
  region                   = "us-east-1"
  requires_compatibilities = ["FARGATE"]

  runtime_platform {
    cpu_architecture        = "X86_64"
    operating_system_family = "LINUX"
  }

  task_role_arn = "arn:aws:iam::244996607989:role/cream-task-role"
  track_latest  = "false"
}
